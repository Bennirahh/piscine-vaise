{% extends 'base.html.twig' %}

{% block title %}Réservation{% endblock %}

{% block body %}
<h1>Créer une nouvelle réservation</h1>
    {# Vérification si l'utilisateur est connecté et affichage de son nom #}
    {% if app.user %}
        <p>Bienvenue, {{ app.user.UserName }} !</p>
    {% else %}
        <p>Vous devez être connecté pour effectuer une réservation.</p>
    {% endif %}
    
{{ form_start(form) }}

<!-- Champ pour choisir le type de réservation -->
<div class="form-group">
    {{ form_label(form.reservationCategory) }}
    {{ form_widget(form.reservationCategory) }}
</div>

<!-- Champ pour la date de réservation -->
<div class="form-group">
    {{ form_label(form.reservationDate) }}
    {{ form_widget(form.reservationDate) }}
</div>

<!-- Champ pour le nombre de personnes -->
<div class="form-group">
    {{ form_label(form.reservationPeaopleNumber) }}
    {{ form_widget(form.reservationPeaopleNumber) }}
</div>

<!-- Champ pour le prix -->
<div class="form-group">
    {{ form_label(form.reservationPrice) }}
    {{ form_widget(form.reservationPrice) }}
</div>

<!-- Section pour l'événement (affichée uniquement si "Event" est sélectionné) -->
<div id="eventSection" class="form-group" style="display: none;">
    {{ form_label(form.event) }}
    {{ form_widget(form.event) }}
</div>

<!-- Section pour le lieu (affichée uniquement si "Location" est sélectionné) -->
<div id="locationSection" class="form-group" style="display: none;">
    {{ form_label(form.location) }}
    {{ form_widget(form.location) }}
</div>

<!-- Section pour l'équipement (affichée uniquement si "Equipement" est sélectionné) -->
<div id="equipementSection" class="form-group" style="display: none;">
    {{ form_label(form.equipement) }}
    {{ form_widget(form.equipement) }}
</div>

<!-- Bouton de soumission -->
<div class="form-group">
    {{ form_widget(form.save) }}
</div>

{{ form_end(form) }}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const reservationCategoryField = document.getElementById("{{ form.reservationCategory.vars.id }}");
    const priceInput = document.querySelector('#{{ form.reservationPrice.vars.id }}');
    
    const eventSelect = document.querySelector('#{{ form.event.vars.id }}');
    const locationSelect = document.querySelector('#{{ form.location.vars.id }}');
    const equipementSelect = document.querySelector('#{{ form.equipement.vars.id }}');

    function updatePrice(selectElement) {
        if (selectElement) {
            const selectedOption = selectElement.options[selectElement.selectedIndex];
            const price = selectedOption.dataset.price || 0; // Récupérer le prix ou 0 par défaut
            priceInput.value = price; // Mettre à jour le champ prix
        }
    }

    function toggleSections() {
        const selectedCategory = reservationCategoryField.value;

        // Cacher toutes les sections
        document.getElementById('eventSection').style.display = 'none';
        document.getElementById('locationSection').style.display = 'none';
        document.getElementById('equipementSection').style.display = 'none';

        // Afficher la section correspondante et mettre à jour le prix
        if (selectedCategory === 'event') {
            document.getElementById('eventSection').style.display = 'block';
            updatePrice(eventSelect);
        } else if (selectedCategory === 'location') {
            document.getElementById('locationSection').style.display = 'block';
            updatePrice(locationSelect);
        } else if (selectedCategory === 'equipement') {
            document.getElementById('equipementSection').style.display = 'block';
            updatePrice(equipementSelect);
        }
    }

    // Initialisation
    toggleSections();

    // Écouter les changements de catégorie
    reservationCategoryField.addEventListener('change', toggleSections);

    // Écouter les changements dans les champs spécifiques
    if (eventSelect) eventSelect.addEventListener('change', () => updatePrice(eventSelect));
    if (locationSelect) locationSelect.addEventListener('change', () => updatePrice(locationSelect));
    if (equipementSelect) equipementSelect.addEventListener('change', () => updatePrice(equipementSelect));
});

</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const eventSelect = document.querySelector('#form_event'); // Vérifiez que l'ID du champ 'event' est correct
    const priceInput = document.querySelector('#form_reservationPrice'); // Vérifiez que l'ID du champ 'prix' est correct

    // Vérifier si l'élément 'eventSelect' existe avant d'ajouter l'événement
    if (eventSelect) {
        eventSelect.addEventListener('change', function() {
            const selectedOption = eventSelect.options[eventSelect.selectedIndex];
            const price = selectedOption.dataset.price || 0; // Obtenir le prix depuis l'attribut data-price
            priceInput.value = price; // Mettre à jour la valeur du champ prix
        });
    }
});

</script>



{% endblock %}
